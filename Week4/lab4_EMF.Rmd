---
title: "Lab 4: Confidence Intervals and T-tests"
author: "Elizabeth Miles-Flynn"
date: "2026-02-11"
output: pdf_document
---

## Set Up

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

# Load necessary packages
library(here)
library(tidyverse)
```

## Data Tidying and Visualization

```{r 1a. Clean urchin dataset to have individual observations}
# load necessary data
urchins.csv <-read.csv(file = here("Week4/urchins.csv"), 
                        stringsAsFactors = TRUE)
str(urchins.csv)

# Trim the original dataset so that only the Year, Month, Site, Treatment, Size, Count, and
# Common Name are included. Then, filter the dataset further to only include data from the
# Mohawk (MOHK) reef for red urchins in 2015 and 2016.
urchins_clean <- urchins.csv %>%
  select(YEAR, MONTH, SITE, TREATMENT, SIZE, COUNT, COMMON_NAME) %>%
  filter(SITE == "MOHK",
         COMMON_NAME == "Red Urchin",
         YEAR %in% c(2015, 2016))

# convert this data from a frequency table to a record of individual observations 
# (hint: try the uncount() function in tidyr)
urchins_uncount <- urchins_clean %>%
  uncount(weights = COUNT, .id = "id")

```

```{r 1b. Create a figure visualizing size distributions by year and treatment}
## Bin sizes with Rice Rule 2n^(1/3) = 18.2115, rounded to 18 per bin, n = 755
2*755^(1/3)

urchin_size <- ggplot(data = urchins_uncount, aes(x = SIZE, fill = TREATMENT)) +
  geom_histogram(bins = 18, color = "black") +
  facet_wrap(vars(YEAR)) + 
  labs(x = "Size (cm)",
       y = "Red Urchin Count (n = 755)",
       title = "Size Distributions of Red Urchins in 2015 and 2016 Across 
       Different Treatments Within Mohawk Reef",
       caption = "Figure 1. Data derived from Santa Barbara Channel LTER 
       measuring red (Mesocentrotus franciscanus) sea urchins size frequency 
       from 2015 and 2016. Annual removal and Control (no removal) were two
       treatments conducted at Mohawk Reef.")

urchin_size
```

## Confidence Intervals

```{r 2a. 95%, two-sided confidence interval for 2015 red urchin sizes across both treatment types}
urchin2015 <- urchins_uncount %>%
  filter(YEAR == 2015)

ttest2015 <- t.test(urchin2015$SIZE,
                    conf.level = 0.95)
ttest2015
```

```{r 2b. 95%, two-sided confidence interval for 2016 red urchin sizes across both treatment types}
urchin2016 <- urchins_uncount %>%
  filter(YEAR == 2016)

ttest2016 <- t.test(urchin2016$SIZE,
                    conf.level = 0.95)
ttest2016
```

##### Question 2 Answers

-   2a. Approximately 131 of the 95% CIs will include the true value of mu (n = 355).

-   2b. Approximately 94 of the 95% CIs will include the true value of mu (n = 400).

## One-sample Hypothesis Tests

```{r 3a. Resesarch claim 2015 urchins are 9 cm size in only control sites, repeat for 2016}
urchin2015_control <- urchins_uncount %>%
  filter(YEAR == 2015, TREATMENT == "CONTROL")

ttest2015_control <- t.test(urchin2015_control$SIZE,
                            mu = 9,
                            conf.level = 0.95,
                            alternative = "two.sided")
ttest2015_control

urchin2016_control <- urchins_uncount %>%
  filter(YEAR == 2016, TREATMENT == "CONTROL")

ttest2016_control <- t.test(urchin2016_control$SIZE,
                            mu = 9,
                            conf.level = 0.95,
                            alternative = "two.sided")
ttest2016_control
```

##### Question 3 Answers

3.  Null hypothesis is that urchin size mean is 9 cm. Alternative hypothesis is that urchin size mean is not 9 cm. Both 2015 AND 2016 urchin true size mean is not equal to 9 cm because we rejected the null hypothesis, since p-values were close to zero and smaller than the significance level of 0.05.

## Two-Sample Hypothesis Tests

```{r 4a. Was size mean different between two treatments in 2015? repeat for 2016 }
t.test(SIZE ~ TREATMENT, data = urchin2015)
t.test(SIZE ~ TREATMENT, data = urchin2016)
```

```{r 4b. Was size mean different between two years?}
urchin_control <- urchins_uncount %>%
  filter(TREATMENT == "CONTROL")

t.test(SIZE ~ YEAR, data = urchin_control)
```

##### Question 4 Answers

-   4a. Null hypothesis is that for both treatments, ANNAUL and CONTROL, urchin size mean is the same. Alternative hypothesis is that for both treatments, urchin size mean is not equal. The p-value is 0.7686 (2015) and 0.05333 (2016) is larger than the significance level of 0.05. This means we fail to reject the null hypothesis for both years (2015 and 2016) and claim that the true size mean difference between treatments is the same.

-   4b. Null hypothesis is that urchin mean size is the same between two years. Alternative hypothesis is that urchin mean size is not equal between two years. The p-value is 0.06056 and greater than the significance level of 0.05. This means we fail to reject the null hypothesis and claim that the true urchin mean sizes in 2015 and 2016 are the same.
